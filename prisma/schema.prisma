generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["ownerdb", "public"]
}

model User {
  id             Int          @id @default(autoincrement())
  name           String       @db.VarChar(50)
  email          String       @unique @db.VarChar(100)
  password       String?      @db.VarChar(255)
  phonenum       String?      @db.VarChar(20)
  userAbility    Int
  preferGame     GameType     @default(FOUR_BALL)
  loginAt        DateTime     @default(now())
  logoutAt       DateTime     @default(now())
  createdAt      DateTime     @default(now())
  mb_id          String?      @unique(map: "bi_user_mb_id_unique") @db.VarChar
  mb_today_login DateTime?    @db.Date
  mb_login_ip    String?      @db.VarChar
  mb_memo_cnt    Int?
  social_id      String?      @db.VarChar(100)
  profile_image  String?      @db.VarChar(255)
  provider       String?      @db.VarChar(20)
  clubs          Club[]
  clubMembers    ClubMember[]

  @@unique([social_id, provider], map: "unique_social_id_provider")
  @@map("bi_user")
  @@schema("public")
}

model Game {
  id          Int      @id @default(autoincrement())
  gameType    GameType
  description String?
  gameAverage String?
  gameHighrun Int
  gameInning  Int
  createdAt   DateTime @default(now())
  endAt       DateTime @default(now())

  @@map("bi_game")
  @@schema("public")
}

model Club {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(100)
  description String?
  userId      Int
  isPossible  Boolean
  createdAt   DateTime     @default(now())
  endAt       DateTime     @default(now())
  user        User         @relation(fields: [userId], references: [id])
  members     ClubMember[]

  @@map("bi_club")
  @@schema("public")
}

model ClubMember {
  clubId   Int
  userId   Int
  joinedAt DateTime @default(now())
  club     Club     @relation(fields: [clubId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@id([clubId, userId])
  @@map("bi_clubmember")
  @@schema("public")
}

model Location {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  description String   @db.VarChar(100)
  address     String   @db.VarChar(255)
  latitude    Float
  longitude   Float
  phone       String?  @db.VarChar(20)
  timeStart   DateTime
  timeEnd     DateTime
  threeBall   Int
  fourBall    Int
  tableType   Int
  createdAt   DateTime @default(now())

  @@map("bi_location")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model bi_admin {
  id         Int       @id @default(autoincrement())
  email      String    @unique
  password   String
  name       String
  role       String
  last_login DateTime? @db.Timestamp(6)

  @@schema("ownerdb")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model bi_maintenance_record {
  id          Int      @id @default(autoincrement())
  table_id    Int
  date        DateTime @db.Timestamp(6)
  description String
  status      String
  checked_by  String
  bi_table    bi_table @relation(fields: [table_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("ownerdb")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model bi_member {
  id               Int                @id @default(autoincrement())
  name             String
  phone            String             @unique
  grade            String
  join_date        DateTime?          @default(now()) @db.Timestamp(6)
  visits           Int?               @default(0)
  total_spent      Int?               @default(0)
  point            Int?               @default(0)
  last_visit       DateTime?          @db.Timestamp(6)
  bi_usage_history bi_usage_history[]

  @@schema("ownerdb")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model bi_reservations {
  id               Int       @id @default(autoincrement())
  store_id         Int
  table_number     Int
  customer_name    String    @db.VarChar(50)
  phone            String    @db.VarChar(20)
  reservation_date DateTime  @db.Date
  start_time       DateTime  @db.Time(6)
  end_time         DateTime  @db.Time(6)
  status           String?   @default("confirmed") @db.VarChar(20)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  updated_at       DateTime? @default(now()) @db.Timestamp(6)
  bi_id            String?   @db.VarChar
  bi_store         bi_store  @relation(fields: [store_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("ownerdb")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model bi_setting {
  id         Int       @id @default(autoincrement())
  key        String    @unique
  value      String
  category   String
  updated_at DateTime? @default(now()) @db.Timestamp(6)

  @@schema("ownerdb")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model bi_store {
  id               Int                      @id @default(autoincrement())
  name             String
  business_no      String?
  owner_name       String?
  phone            String?
  address          String?
  open_time        String?
  close_time       String?
  comment          String?                  @db.VarChar
  hourly_rate      Int?
  per_minute       Int?
  least_rate       Int?
  open_yoil        String?
  bi_id            String?                  @unique(map: "unique_bi_id") @db.VarChar
  has_table        Int?
  directions       String?                  @db.VarChar
  parking_type     String?                  @db.VarChar
  parking_capacity Int?
  parking_note     String?                  @db.VarChar
  weekend_rate     Int?
  brand            String?                  @db.VarChar
  facilities       String?                  @db.VarChar
  saturday_open    String?                  @db.VarChar
  saturday_close   String?                  @db.VarChar
  sunday_open      String?                  @db.VarChar
  sunday_close     String?                  @db.VarChar
  regular_holiday  String?
  created_at       DateTime?                @db.Date
  updated_at       DateTime?                @db.Date
  phone_store      String?                  @db.VarChar
  coord_x          String?                  @db.VarChar
  coord_y          String?                  @db.VarChar
  register_id      String?                  @db.VarChar
  geom             Unsupported("geometry")?
  bi_reservations  bi_reservations[]

  @@index([geom], map: "idx_bi_store_geom", type: Gist)
  @@map("bi_store")
  @@schema("ownerdb")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model bi_table {
  id                    Int                     @id @default(autoincrement())
  name                  String
  type                  String
  status                String
  hourly_rate           Int
  bi_id                 String                  @db.VarChar
  table_no              Int?
  x                     Float?                  @default(50)
  y                     Float?                  @default(50)
  width                 Float?                  @default(120)
  height                Float?                  @default(60)
  rotation              Int?
  bi_maintenance_record bi_maintenance_record[]
  bi_usage_history      bi_usage_history[]

  @@schema("ownerdb")
}

model bi_usage_history {
  id        Int       @id @default(autoincrement())
  member_id Int
  table_id  Int
  date      DateTime  @db.Timestamp(6)
  duration  Float
  amount    Int
  bi_member bi_member @relation(fields: [member_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  bi_table  bi_table  @relation(fields: [table_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("ownerdb")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)

  @@schema("public")
}

enum GameType {
  THREE_BALL @map("3구")
  FOUR_BALL  @map("4구")

  @@schema("public")
}
